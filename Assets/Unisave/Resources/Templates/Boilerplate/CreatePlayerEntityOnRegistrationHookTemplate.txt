using System;
using System.Collections;
using System.Collections.Generic;
using Unisave;

public class #HOOKNAME# : PlayerRegistrationHook
{
    /// <summary>
    /// Execution order against other registration hooks
    /// </summary>
    public override int Order => 1;
    
    /// <summary>
    /// Creates PlayerEntity for a new player
    /// </summary>
    public override void Run()
    {
        // get the name, player typed in during registration
        string requestedName = GetArgument<string>("name");

        if (requestedName == null || requestedName.Length == 0)
            Reject("Player name has to be provided as well.");

        // check if this name is already used
        PlayerEntity playerEntity = GetEntity<PlayerEntity>
            .OfAnyPlayers()
            .Where("Name", requestedName)
            .First();

        if (playerEntity != null)
            Reject("This name is already taken.");

        // create player entity
        playerEntity = new PlayerEntity {
            Name = requestedName
        };
        playerEntity.Owners.Add(Player);
        playerEntity.Save();
    }
}
